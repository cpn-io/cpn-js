<!-- Project tree toolbar -->
<app-project-tree-toolbar (newNode)="onNewNode()" (deleteNode)="onDeleteNode()" (upNode)="onUpNode()"
  (downNode)="onDownNode()">
  <!-- <app-project-tree-toolbar> -->
</app-project-tree-toolbar>

<div class="tab-container-with-toolbar">

  <ng-container *ngIf="cpnet">

    <div id="tree" class="tree" (keydown)="onKeyDown($event)" (click)="disableContextMenu()"
      oncontextmenu="return false;">

      <!-- Project root -->
      <app-tree-node id="project" type="root" [title]="'Project: ' + project.name" [expanded]="expanded" [selected]="selected"
        [showBullet]="false">

        <div class="node" [textContent]="'Step: ' + simulationState.step"></div>
        <div class="node" [textContent]="'Time: ' + simulationState.time"></div>

        <!-- Options -->
        <app-tree-node id="options" title="Options" [expanded]="expanded" [selected]="selected" type="options"
          [cpnElement]="undefined">

          <app-project-tree-options-node [optionList]="nodeToArray(cpnet.options.option)" [expanded]="expanded"
            [selected]="selected"></app-project-tree-options-node>

        </app-tree-node>


        <!-- Declarations -->
        <app-tree-node id="declarations" type="declarations" title="Declarations" [expanded]="expanded"
          [selected]="selected" [cpnElement]="undefined" (contextmenu)="onRightClick($event)">

          <ng-container *ngFor="let globbox of nodeToArray(cpnet.globbox)">
            <ng-container *ngFor="let block of nodeToArray(globbox.block)">
              <app-project-tree-block-node [block]="block" [expanded]="expanded" [selected]="selected"
                [mouseover]="mouseover">
              </app-project-tree-block-node>
            </ng-container>
          </ng-container>

        </app-tree-node>


        <!-- Monitors -->
        <app-project-tree-monitorblock-node [monitorblock]="cpnet.monitorblock" [expanded]="expanded"
          [selected]="selected">
        </app-project-tree-monitorblock-node>

        <!-- Pages -->
        <app-tree-node id="pages" title="Pages" [expanded]="expanded" [selected]="selected" [type]="'root'"
          [cpnElement]="undefined" (contextmenu)="onRightClick($event)">

          <ng-container *ngFor="let page of pages">
            <ng-container *ngIf="!subpages.includes(page._id)">
              <app-project-tree-page-node [page]="page" [subpages]="subpages" [expanded]="expanded"
                [selected]="selected">
              </app-project-tree-page-node>
            </ng-container>
          </ng-container>

        </app-tree-node>

      </app-tree-node>

    </div>

  </ng-container>
</div>


<!-- Tree node context menu -->
<div *ngIf="contextmenu">
  <app-context-menu [x]="contextmenuX" [y]="contextmenuY">
    <a *ngIf="selected && ['globref', 'color', 'var', 'ml', 'block'].includes(selected.type)" class="dropdown-item"
      href="#" (click)="onNewDeclaration()">New declaration</a>
    <a *ngIf="selected && ['globref', 'color', 'var', 'ml', 'block'].includes(selected.type)" class="dropdown-item"
      href="#" (click)="onNewBlock()">New block</a>
    <!-- <div class="dropdown-divider" href="#"></div> -->
    <a *ngIf="selected && ['page'].includes(selected.type)" class="dropdown-item" href="#" (click)="onNewPage()">New
      page</a>
  </app-context-menu>
</div>